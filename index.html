<!DOCTYPE html>
<html>
  <head>
    <title>GitHub Copilot</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="theme-color" content="#0d1117">
    <link rel="manifest" href="manifest.json">
    <style>
      body { 
        margin: 0; 
        background: #0d1117; 
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
        color: white;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        height: 100vh;
        text-align: center;
        padding: 20px;
        box-sizing: border-box;
      }
      .button {
        background: #238636;
        color: white;
        border: none;
        padding: 12px 24px;
        border-radius: 6px;
        font-size: 16px;
        cursor: pointer;
        margin: 10px;
        text-decoration: none;
        display: inline-block;
      }
    </style>
  </head>
  <body>
    <div style="font-size: 48px; margin-bottom: 20px;">ðŸ¤–</div>
    <h1>GitHub Copilot</h1>
    
    <div id="content">
      <p>Install this app for the best experience!</p>
      <button class="button" onclick="redirectToCopilot()">Continue to Copilot</button>
    </div>
    
    <script>
      function isPWA() {
        return window.matchMedia('(display-mode: standalone)').matches || 
               window.navigator.standalone === true ||
               document.referrer.includes('android-app://');
      }

      function redirectToCopilot() {
        // Store cleanup preferences for the redirect
        storeCleanupPreferences();
        
        // Create a more direct GitHub Copilot URL that might avoid the conversation bar
        const copilotUrl = buildCleanCopilotUrl();
        
        // Try opening in the same tab but with intent to minimize browser UI
        try {
          window.location.href = copilotUrl;
        } catch (e) {
          window.open(copilotUrl, '_self');
        }
      }

      function buildCleanCopilotUrl() {
        // Try different GitHub Copilot URLs that might provide cleaner interface
        const baseUrl = 'https://github.com/copilot';
        const params = new URLSearchParams();
        
        // Add parameters that might control GitHub's UI
        params.set('tab', 'chat');
        params.set('embedded', 'true');
        params.set('minimal', 'true');
        params.set('hide_header', 'true');
        params.set('pwa', 'true');
        
        return `${baseUrl}?${params.toString()}`;
      }

      function storeCleanupPreferences() {
        // Store cleanup CSS in localStorage and sessionStorage for persistence
        const cleanupCSS = `
          /* Hide GitHub's "X New Conversation" bar and related UI elements */
          [data-testid="new-conversation-banner"],
          [data-testid="copilot-banner"],
          .js-new-conversation-banner,
          .conversation-banner,
          .copilot-conversation-banner,
          .notification-banner,
          .flash-banner,
          .global-banner,
          .top-banner,
          [class*="conversation-banner"],
          [class*="ConversationBanner"],
          [class*="NotificationBanner"],
          [aria-label*="conversation"],
          [aria-label*="New conversation"],
          .Header-item--full-width {
            display: none !important;
            visibility: hidden !important;
            opacity: 0 !important;
            height: 0 !important;
            margin: 0 !important;
            padding: 0 !important;
            position: absolute !important;
            left: -9999px !important;
          }
          
          /* Clean up top spacing */
          body {
            padding-top: 0 !important;
            margin-top: 0 !important;
          }
          
          .AppHeader,
          .Header {
            border-bottom: none !important;
          }
          
          /* Hide specific GitHub header items that might contain conversation bar */
          .AppHeader .Header-item:has([data-testid*="conversation"]),
          .AppHeader .Header-item:has([class*="conversation"]) {
            display: none !important;
          }
        `;
        
        localStorage.setItem('copilot-pwa-cleanup', 'true');
        localStorage.setItem('copilot-pwa-cleanup-css', cleanupCSS);
        sessionStorage.setItem('copilot-pwa-cleanup', 'true');
        sessionStorage.setItem('copilot-pwa-cleanup-css', cleanupCSS);
        
        // Set a flag to indicate this is a PWA redirect
        localStorage.setItem('copilot-pwa-source', window.location.origin);
        
        // Inject a script element that will be available on redirect
        const script = document.createElement('script');
        script.textContent = `
          (function() {
            if (localStorage.getItem('copilot-pwa-cleanup') === 'true') {
              const style = document.createElement('style');
              style.id = 'copilot-pwa-cleanup-style';
              style.textContent = localStorage.getItem('copilot-pwa-cleanup-css');
              
              if (document.head) {
                document.head.appendChild(style);
              } else {
                document.addEventListener('DOMContentLoaded', () => {
                  document.head.appendChild(style);
                });
              }
              
              // Remove elements via DOM manipulation
              const cleanupDOM = () => {
                const selectors = [
                  '[data-testid="new-conversation-banner"]',
                  '[data-testid="copilot-banner"]',
                  '.js-new-conversation-banner',
                  '.conversation-banner',
                  '.copilot-conversation-banner',
                  '.notification-banner',
                  '[class*="conversation-banner"]',
                  '[class*="ConversationBanner"]',
                  '[aria-label*="conversation"]',
                  '[aria-label*="New conversation"]'
                ].join(', ');
                
                const elements = document.querySelectorAll(selectors);
                elements.forEach(el => {
                  el.style.display = 'none';
                  el.style.visibility = 'hidden';
                  el.remove();
                });
              };
              
              // Run cleanup immediately and on DOM changes
              if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', cleanupDOM);
              } else {
                cleanupDOM();
              }
              
              // Use MutationObserver to catch dynamically added elements
              const observer = new MutationObserver(cleanupDOM);
              observer.observe(document.body || document.documentElement, {
                childList: true,
                subtree: true
              });
              
              // Cleanup after 30 seconds to avoid indefinite observation
              setTimeout(() => observer.disconnect(), 30000);
            }
          })();
        `;
        
        // Try to inject this script in a way that persists
        document.head.appendChild(script);
      }

      // If already in PWA mode, auto-redirect with delay
      if (isPWA()) {
        document.getElementById('content').innerHTML = 
          '<p>Launching GitHub Copilot...</p>';
        setTimeout(redirectToCopilot, 2000);
      }

      // Apply cleanup if we're already on GitHub (in case of back navigation)
      if (window.location.hostname.includes('github.com')) {
        applyCleanupOnGitHub();
      }

      function applyCleanupOnGitHub() {
        // This function runs when we're already on GitHub domain
        const cleanupCSS = localStorage.getItem('copilot-pwa-cleanup-css');
        if (cleanupCSS) {
          const style = document.createElement('style');
          style.id = 'copilot-pwa-cleanup-style';
          style.textContent = cleanupCSS;
          document.head.appendChild(style);
          
          // Direct DOM cleanup
          const cleanupElements = () => {
            const selectors = [
              '[data-testid="new-conversation-banner"]',
              '[data-testid="copilot-banner"]',
              '.js-new-conversation-banner',
              '.conversation-banner',
              '.copilot-conversation-banner',
              '.notification-banner',
              '[class*="conversation-banner"]',
              '[class*="ConversationBanner"]'
            ];
            
            selectors.forEach(selector => {
              document.querySelectorAll(selector).forEach(el => el.remove());
            });
          };
          
          cleanupElements();
          setInterval(cleanupElements, 2000); // Re-check every 2 seconds
        }
      }
    </script>
  </body>
</html>
